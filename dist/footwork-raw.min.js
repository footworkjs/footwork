/**, * footwork.js - A solid footing for web applications., * Author: Jonathan Newman (http://staticty.pe), * Version: v0.2.0, * Url: http://footworkjs.com, * License(s): MIT, */,,function parseUri(e){for(var t=parseUri.options,n=t.parser[t.strictMode?"strict":"loose"].exec(e),i={},r=14;r--;)i[t.key[r]]=n[r]||"";return i[t.q.name]={},i[t.key[12]].replace(t.q.parser,function(e,n,r){n&&(i[t.q.name][n]=r)}),i}function indexedNamespaceName(e,t){return isUndefined(namespaceNameCounter[e])?namespaceNameCounter[e]=0:namespaceNameCounter[e]++,e+(t===!0?namespaceNameCounter[e]:"")}function createEnvelope(e,t,n){var i={topic:e,data:t};return isUndefined(n)||(i.headers={preserve:!0},n instanceof Date&&(i.expires=n)),i}function triggerEventOnNamespace(e,t,n){return this.publish(createEnvelope("event."+e,t,n)),this}function registerNamespaceEventHandler(e,t,n){isUndefined(n)||(t=bind(t,n));var i=this.subscribe("event."+e,t).enlistPreserved();return this.eventHandlers.push(i),i}function unregisterNamespaceHandler(e){return e.unsubscribe(),this}function sendCommandToNamespace(e,t,n){return this.publish(createEnvelope("command."+e,t,n)),this}function registerNamespaceCommandHandler(e,t,n){isUndefined(n)||(t=bind(t,n));var i=this.subscribe("command."+e,t).enlistPreserved();return this.commandHandlers.push(i),i}function requestResponseFromNamespace(e,t,n){var i,r=void 0;return i=this.subscribe("request."+e+".response",function(e){isUndefined(r)?r=n?[e]:e:n&&r.push(e)}),this.publish(createEnvelope("request."+e,t)),i.unsubscribe(),r}function registerNamespaceRequestHandler(e,t,n){isUndefined(n)||(t=bind(t,n));var i=bind(function(n){var i=t(n);this.publish(createEnvelope("request."+e+".response",i))},this),r=this.subscribe("request."+e,i);return this.requestHandlers.push(r),r}function disconnectNamespaceHandlers(){return invoke(this.requestHandlers,"unsubscribe"),invoke(this.commandHandlers,"unsubscribe"),invoke(this.eventHandlers,"unsubscribe"),this}function getNamespaceName(){return this.channel}function isReceiver(e){return isObject(e)&&!!e.__isReceiver}function isBroadcaster(e){return isObject(e)&&!!e.__isBroadcaster}function transformRouteConfigToDesc(e){return extend({id:uniqueId("route")},baseRouteDescription,e)}function routeStringToRegExp(e){return e=e.replace(escapeRegex,"\\$&").replace(optionalParamRegex,"(?:$1)?").replace(namedParamRegex,function(e,t){return t?e:"([^/]+)"}).replace(splatParamRegex,"(.*?)"),new RegExp("^"+e+("/"!==e?"(\\/.*)*$":"$"),routesAreCaseSensitive?void 0:"i")}function historyIsReady(){var e=has(History,"Adapter");return e&&isUndefined(History.Adapter.unbind)&&(History.Adapter.unbind=function(e){each(History.Adapter.handlers,function(t){t.statechange=filter(t.statechange,function(t){return t!==e})})}),e}function isNullRouter(e){return isObject(e)&&!!e.__isNullRouter}function isRouter(e){return isObject(e)&&!!e.__isRouter}function isRoute(e){return isObject(e)&&!!e.__isRoute}function nearestParentRouter(e){var t=$nullRouter;return isObject(e)&&(isObject(e.$data)&&isRouter(e.$data.$router)?t=e.$data.$router:(isObject(e.$parentContext)||isObject(e.$data)&&isObject(e.$data.$parentContext))&&(t=nearestParentRouter(e.$parentContext||e.$data.$parentContext))),t}function isViewModelCtor(e){return isFunction(e)&&!!e.__isViewModelCtor}function isViewModel(e){return isObject(e)&&!!e.__isViewModel}function beforeInitMixins(e){return!!e.runBeforeInit}function applyContextAndLifeCycle(e,t){if(isViewModel(e)){var n=e.__getConfigParams();t=t||document.body,e.$context=elementContext=fw.contextFor(t),isFunction(n.afterBinding)&&n.afterBinding.call(e,t),isRouter(e.$router)&&e.$router.context(elementContext),isUndefined(t)||fw.utils.domNodeDisposal.addDisposeCallback(t,function(){e.__shutdown()})}}function bindComponentViewModel(e,t,n){var i;i=isFunction(n)?new n(values.params):n,i.$parentContext=fw.contextFor(e.parentElement),each(e.children,function(e){originalApplyBindings(i,e)}),applyContextAndLifeCycle(i,e),isRouter(i.$router)&&i.$router.context(fw.contextFor(e))}function isNativeComponent(e){return-1!==indexOf(nativeComponents,e)}function componentTriggerAfterBinding(e,t){if(isViewModel(t)){var n=t.__getConfigParams();isFunction(n.afterBinding)&&n.afterBinding.call(t,e)}}var fw=ko;fw.footworkVersion="0.2.0",fw.embed=embedded;var hasTrailingSlash=/\/$/i,hasStartingSlash=/^\//i,noop=function(){},isObservable=fw.isObservable,isPath=function(e){return hasTrailingSlash.test(e)},hasPathStart=function(e){return hasStartingSlash.test(e)},isFunction=_.isFunction,isObject=_.isObject,isString=_.isString,isBoolean=_.isBoolean,isNumber=_.isNumber,isUndefined=_.isUndefined,isArray=_.isArray,isNull=_.isNull,contains=_.contains,extend=_.extend,pick=_.pick,each=_.each,filter=_.filter,bind=_.bind,invoke=_.invoke,clone=_.clone,reduce=_.reduce,has=_.has,where=_.where,result=_.result,uniqueId=_.uniqueId,map=_.map,find=_.find,omit=_.omit,indexOf=_.indexOf,values=_.values,reject=_.reject,findWhere=_.findWhere,once=_.once,viewModelMixins=[];parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var namespaceNameCounter={},namespaceStack=[],makeNamespace=fw.namespace=function(e,t){isUndefined(t)||(isString(t)?e=t+"."+e:isUndefined(t.channel)||(e=t.channel+"."+e));var n=postal.channel(e);return n.__isNamespace=!0,n.shutdown=bind(disconnectNamespaceHandlers,n),n.commandHandlers=[],n.command=bind(sendCommandToNamespace,n),n.command.handler=bind(registerNamespaceCommandHandler,n),n.command.handler.unregister=bind(unregisterNamespaceHandler,n),n.requestHandlers=[],n.request=bind(requestResponseFromNamespace,n),n.request.handler=bind(registerNamespaceRequestHandler,n),n.request.handler.unregister=bind(unregisterNamespaceHandler,n),n.eventHandlers=[],n.event=n.trigger=bind(triggerEventOnNamespace,n),n.event.handler=bind(registerNamespaceEventHandler,n),n.event.handler.unregister=bind(unregisterNamespaceHandler,n),n.getName=bind(getNamespaceName,n),n.enter=function(){return enterNamespace(this)},n.exit=function(){return currentNamespaceName()===this.getName()?exitNamespace():void 0},n},isNamespace=fw.isNamespace=function(e){return!isUndefined(e)&&!!e.__isNamespace},currentNamespaceName=fw.currentNamespaceName=function(){return namespaceStack[0]},currentNamespace=fw.currentNamespace=function(){return makeNamespace(currentNamespaceName())},enterNamespaceName=fw.enterNamespaceName=function(e){currentNamespace();return namespaceStack.unshift(e),makeNamespace(currentNamespaceName())},enterNamespace=fw.enterNamespace=function(e){return namespaceStack.unshift(e.getName()),e},exitNamespace=fw.exitNamespace=function(){return namespaceStack.shift(),currentNamespace()};viewModelMixins.push({runBeforeInit:!0,_preInit:function(){var e=this.__getConfigParams();this.$namespace=enterNamespaceName(indexedNamespaceName(e.componentNamespace||e.namespace||e.name||_.uniqueId("namespace"),e.autoIncrement)),this.$globalNamespace=makeNamespace()},mixin:{getNamespaceName:function(){return this.$namespace.getName()}},_postInit:function(){exitNamespace()}});var $globalNamespace=makeNamespace();fw.subscribable.fn.receiveFrom=function(e,t){var n=this,i=this,r=[],o=!1;if(isString(e)&&(e=makeNamespace(e),o=!0),!isNamespace(e))throw"Invalid namespace provided for receiveFrom() observable.";i=fw.computed({read:n,write:function(n){e.publish("__change."+t,n)}}),i.refresh=function(){return e.publish("__refresh."+t),this},r.push(e.subscribe(t,function(e){n(e)}));var s=i.dispose;return i.dispose=i.shutdown=function(){invoke(r,"unsubscribe"),o&&e.shutdown(),s.call(i)},i.__isReceiver=!0,i.refresh()},fw.subscribable.fn.broadcastAs=function(e,t){var n,i=this,r=[],o=[],s=!1;if(t=isObject(e)?e:isBoolean(t)?{name:e,writable:t}:isObject(t)?extend({name:e},t):{name:e},n=t.namespace||currentNamespace(),isString(n)&&(n=makeNamespace(n),s=!0),!isNamespace(n))throw"Invalid namespace provided for broadcastAs() observable.";return t.writable&&o.push(n.subscribe("__change."+t.name,function(e){i(e)})),i.broadcast=function(){return n.publish(t.name,i()),this},o.push(n.subscribe("__refresh."+t.name,function(){n.publish(t.name,i())})),r.push(i.subscribe(function(e){n.publish(t.name,e)})),i.dispose=i.shutdown=function(){invoke(o,"unsubscribe"),invoke(r,"dispose"),s&&n.shutdown()},i.__isBroadcaster=!0,i.broadcast()};var alwaysPassPredicate=function(){return!0},emptyStringResult=function(){return""},routerDefaultConfig={namespace:"$router",baseRoute:null,isRelative:!0,activate:!0,setHref:!0,routes:[]},optionalParamRegex=/\((.*?)\)/g,namedParamRegex=/(\(\?)?:\w+/g,splatParamRegex=/\*\w*/g,escapeRegex=/[\-{}\[\]+?.,\\\^$|#\s]/g,hashMatchRegex=/(^\/#)/,isFullURLRegex=/(^[a-z]+:\/\/|^\/\/)/i,routesAreCaseSensitive=!0,invalidRoutePathIdentifier="___invalid-route",$nullRouter=extend({},$baseRouter,{childRouters:extend(bind(noop),{push:noop}),routePath:function(){return""},isRelative:function(){return!1},__isNullRouter:!0}),$baseRouter={routePath:emptyStringResult,routeSegment:emptyStringResult,childRouters:fw.observableArray(),context:noop,__isRouter:!0},baseRoute={controller:noop,indexedParams:[],namedParams:{},__isRoute:!0},baseRouteDescription={__isRouteDesc:!0,filter:alwaysPassPredicate},noComponentSelected="_noComponentSelected",$routerOutlet=function(e,t,n){n=n||{},isFunction(n)&&(n={onComplete:n});var i=n.params,r=n.onComplete,o=this.outlets;e=fw.unwrap(e),isObservable(o[e])||(o[e]=fw.observable({name:noComponentSelected,params:{},__getOnCompleteCallback:function(){return noop}}));var s=o[e],a=s(),u=!1,c=s().name===noComponentSelected;if(isUndefined(t)||(a.name=t,u=!0),isUndefined(i)||(a.params=i,u=!0),u){if(isFunction(r)){var l=c?0:1;a.__getOnCompleteCallback=function(){var e=0===l;return l--,e?r:noop}}else a.__getOnCompleteCallback=function(){return noop};s.valueHasMutated()}return s},isFullURL=fw.isFullURL=function(e){return isString(e)&&isFullURLRegex.test(e)};fw.routers={baseRoute:fw.observable(""),getNearestParent:function(e){var t=nearestParentRouter(e);return isNullRouter(t)?null:t},getAll:function(){return reduce($globalNamespace.request("__router_reference",void 0,!0),function(e,t){var n=isNamespace(t.$namespace)?t.$namespace.getName():null;return isNull(n)||(isUndefined(e[n])?e[n]=t:(isArray(e[n])||(e[n]=[e[n]]),e[n].push(t))),e},{})}},fw.router=function(e,t,n){return new Router(e,t,n)},fw.bindingHandlers.$route={init:function(e,t,n,i,r){function o(t){var n=p.url(),i=n||e.getAttribute("href")||"";return isNull(n)?null:(isUndefined(n)&&(n=i),isFullURL(i)||(hasPathStart(i)||(i="/"+i),t&&!isNullRouter(a)&&(i=a.parentRouter().routePath()+i)),i)}function s(){c&&(c=!1,fw.utils.registerEventHandler(e,p.eventType,function(e){var t=p.handler.call(i,e,p.url());t===!0&&(t=d()),isString(t)&&!isFullURL(t)&&a.setState(t)})),"a"===e.tagName.toLowerCase()&&(e.href=l())}var a=nearestParentRouter(r),u=t(),c=!0,l=bind(o,null,!0),d=bind(o,null,!1),p={eventType:"click",url:function(){return null},handler:function(e,t){return isFullURL(t)?!1:(e.preventDefault(),!0)}};if(isObservable(u)||isFunction(u)||isString(u))p.url=u;else if(isObject(u))extend(p,u);else{if(!isUndefined(u))throw"Unknown type of url value provided to $route ["+typeof u+"]";p.url=e.getAttribute("href")}var m=p.url;isFunction(m)||(p.url=function(){return m}),isObservable(p.url)&&p.url.subscribe(s),s()}};var Router=function(e,t,n){extend(this,$baseRouter);var i,r=this.subscriptions=[];isViewModel(t)&&(i=t.getNamespaceName()),this.id=uniqueId("router"),this.$globalNamespace=makeNamespace(),this.$namespace=makeNamespace(e.namespace||i+"Router"),this.$namespace.enter(),this.$namespace.command.handler("setState",this.setState,this),this.$namespace.request.handler("currentRoute",function(){return this.currentRoute()},this),this.$namespace.request.handler("urlParts",function(){return this.urlParts()},this),this.$viewModel=t,this.urlParts=fw.observable(),this.childRouters=fw.observableArray(),this.parentRouter=fw.observable($nullRouter),this.context=fw.observable(),this.historyIsEnabled=fw.observable(!1).broadcastAs("historyIsEnabled"),this.currentState=fw.observable("").broadcastAs("currentState"),this.config=e=extend({},routerDefaultConfig,e),this.config.baseRoute=fw.routers.baseRoute()+(result(e,"baseRoute")||""),this.isRelative=fw.computed(function(){return e.isRelative&&!isNullRouter(this.parentRouter())},this),this.currentRoute=fw.computed(function(){return this.getRouteForURL(this.currentState())},this),this.routePath=fw.computed(function(){var e=this.currentRoute(),t=(this.parentRouter(),this.parentRouter().routePath());return isRoute(e)&&(t+=e.routeSegment),t},this);var o=$nullRouter;r.push(this.parentRouter.subscribe(function(e){isNullRouter(o)||o===e||o.childRouters.remove(this),e.childRouters.push(this),o=e},this)),r.push(this.currentRoute.subscribe(function(e){this.getActionForRoute(e)()},this));var s=this;this.$globalNamespace.request.handler("__router_reference",function(){return s}),this.outlets={},this.$outlet=bind($routerOutlet,this),this.$outlet.reset=bind(function(){each(this.outlets,function(e){e({name:noComponentSelected,params:{}})})},this),isUndefined(e.unknownRoute)||(isFunction(e.unknownRoute)&&(e.unknownRoute={controller:e.unknownRoute}),e.routes.push(extend(e.unknownRoute,{unknown:!0}))),this.setRoutes(e.routes),e.activate===!0&&r.push(this.context.subscribe(function(e){isObject(e)&&this.activate(e)},this)),this.context(t.$context||n),this.$namespace.exit()};Router.prototype.setRoutes=function(e){return this.routeDescriptions=[],this.addRoutes(e),this},Router.prototype.addRoutes=function(e){return this.routeDescriptions=this.routeDescriptions.concat(map(isArray(e)?e:[e],transformRouteConfigToDesc)),this},Router.prototype.activate=function(e,t){return this.startup(e,t),""===this.currentState()&&this.setState(),this},Router.prototype.setState=function(e,t){if(this.historyIsEnabled())if(!t&&isString(e)){var n=!0;try{n=History.pushState(null,"",this.parentRouter().routePath()+e)}catch(i){n=!1}finally{if(n)return}}else e=History.getState().url;isString(e)&&this.currentState(this.normalizeURL(e))},Router.prototype.startup=function(e,t){var n=this;return t=t||$nullRouter,isNullRouter(t)?isObject(e)&&(t=nearestParentRouter(e),t.id!==this.id&&this.parentRouter(t)):this.parentRouter(t),this.historyIsEnabled()||(historyIsReady()?(History.Adapter.bind(windowObject,"statechange",this.stateChangeHandler=function(){n.setState(History.getState().url,!0)}),this.historyIsEnabled(!0)):this.historyIsEnabled(!1)),this},Router.prototype.shutdown=function(){var e=this.parentRouter();isNullRouter(e)||e.childRouters.remove(this),this.historyIsEnabled()&&historyIsReady()&&History.Adapter.unbind(this.stateChangeHandler),this.$namespace.shutdown(),this.$globalNamespace.shutdown(),invoke(this.subscriptions,"dispose"),each(this,function(e){e&&isFunction(e.dispose)&&e.dispose()})},Router.prototype.normalizeURL=function(e){var t=parseUri(e);return this.urlParts(t),e=t.path,isNull(this.config.baseRoute)||0!==e.indexOf(this.config.baseRoute)||(e=e.substr(this.config.baseRoute.length),e.length>1&&(e=e.replace(hashMatchRegex,"/"))),e},Router.prototype.getUnknownRoute=function(){var e=findWhere((this.getRouteDescriptions()||[]).reverse(),{unknown:!0})||null;return isNull(e)||(e=extend({},baseRoute,{id:e.id,controller:e.controller,title:e.title,routeSegment:""})),e},Router.prototype.getRouteForURL=function(e){var t=null,n=this.parentRouter().routePath()||"",i=this.getUnknownRoute(),r=this;if(this.isRelative()){if(!(n.length>0))return i;if(0!==(routeIndex=e.indexOf(n)))return i;e=e.substr(n.length)}var o=[];if(find(this.getRouteDescriptions(),function(n){var i=n.route,s=[];return isString(i)&&(s=e.match(routeStringToRegExp(i)),!isNull(s)&&n.filter.call(r,{params:s,urlParts:r.urlParts()})&&o.push({routeString:i,specificity:i.replace(namedParamRegex,"*").length,routeDescription:n,routeParams:s})),t}),o.length){var s=reduce(o,function(e,t){return(isNull(e)||t.specificity>e.specificity)&&(e=t),e},null),a=s.routeDescription,u=s.routeString,c=clone(s.routeParams),l=c.pop()||"",d=map(u.match(namedParamRegex),function(e){return e.replace(":","")}),p=reduce(d,function(e,t,n){return e[t]=c[n+1],e},{});t=extend({},baseRoute,{id:a.id,controller:a.controller,title:a.title,url:e,routeSegment:e.substr(0,e.length-l.length),indexedParams:c,namedParams:p})}return t||i},Router.prototype.getActionForRoute=function(e){var t=bind(function(){delete this.__currentRouteDescription,this.$outlet.reset()},this);return isRoute(e)&&(t=bind(function(){isUndefined(e.title)||(document.title=isFunction(e.title)?e.title.call(this):e.title),(isUndefined(this.__currentRouteDescription)||this.__currentRouteDescription.id!==e.id)&&(e.controller.call(this,e.namedParams),this.__currentRouteDescription=e)},this)),t},Router.prototype.getRouteDescriptions=function(){return this.routeDescriptions};var defaultGetViewModelOptions={includeOutlets:!1};fw.viewModels={};var getViewModels=fw.viewModels.getAll=function(e){return reduce($globalNamespace.request("__model_reference",extend({},defaultGetViewModelOptions,e),!0),function(e,t){if(!isUndefined(t)){var n=isNamespace(t.$namespace)?t.$namespace.getName():null;isNull(n)||(isUndefined(e[n])?e[n]=t:(isArray(e[n])||(e[n]=[e[n]]),e[n].push(t)))}return e},{})},refreshViewModels=fw.viewModels.refresh=function(){$globalNamespace.trigger("__refreshViewModels")},defaultViewModelConfigParams={namespace:void 0,name:void 0,componentNamespace:void 0,autoIncrement:!1,mixins:void 0,params:void 0,initialize:noop,afterInit:noop,afterBinding:noop,afterDispose:noop},makeViewModel=fw.viewModel=function(e){e=e||{};var t=noop,n=noop,i=e.parent;isUndefined(e)||(t=e.viewModel||e.initialize||noop,n=e.afterInit||noop),n={_postInit:n},e=extend({},defaultViewModelConfigParams,e);var r={_preInit:function(){isObject(e.router)&&(this.$router=new Router(e.router,this))},mixin:{__isViewModel:!0,$params:result(e,"params"),__getConfigParams:function(){return e},__shutdown:function(){isFunction(e.afterDispose)&&e.afterDispose.call(this),each(this,function(e){(isNamespace(e)||isRouter(e)||isBroadcaster(e)||isReceiver(e))&&e.shutdown()})}},_postInit:function(){this.__assertPresence!==!1&&(this.$globalNamespace.request.handler("__model_reference",bind(function(e){return!this.__isOutlet||isObject(e)&&e.includeOutlets?this:void 0},this)),this.$globalNamespace.event.handler("__refreshViewModels",bind(function(){each(this,function(e){isReceiver(e)&&e.refresh()})},this)))}};if(isViewModelCtor(t))u=t;else{var o=[t],s=reject(viewModelMixins,a),a=filter(viewModelMixins,a);a.length&&(o=o.concat(a)),o=o.concat(r),s.length&&(o=o.concat(s)),o=o.concat(n),isUndefined(e.mixins)||(o=o.concat(e.mixins)),each(o,function(e){isUndefined(e.runBeforeInit)||delete e.runBeforeInit});var u=riveter.compose.apply(void 0,o);u.__isViewModelCtor=!0,u.__configParams=e}return isUndefined(i)||u.inherits(i),u},originalApplyBindings=fw.applyBindings,applyBindings=fw.applyBindings=function(e,t){originalApplyBindings(e,t),applyContextAndLifeCycle(e,t)},originalComponentInit=fw.bindingHandlers.component.init;fw.bindingHandlers.component.init=function(e,t,n,i,r){var o=t;if(isString(e.tagName)){var s=e.tagName.toLowerCase();if("viewmodel"===s){var a=t(),u=(isUndefined(a.params)?void 0:fw.unwrap(a.params.name))||e.getAttribute("module")||e.getAttribute("data-module"),c=bind(bindComponentViewModel,null,e,a.params);if(!isUndefined(u)){var l=null;if(l=isRegisteredViewModel(u)?getRegisteredViewModel(u):isFunction(require)&&isFunction(require.defined)&&require.defined(u)?u:getViewModelResourceLocation(u),isString(l)){if(!isFunction(require))throw"Uses require, but no AMD loader is present";isPath(l)&&(l+=getViewModelFileName(u)),require([l],c)}else isFunction(l)?c(l):isObject(l)&&(isObject(l.instance)?c(l.instance):isFunction(l.createViewModel)&&c(l.createViewModel(a.params,{element:e})))}return{controlsDescendantBindings:!0}}if("outlet"===s){var d=e.getAttribute("name")||e.getAttribute("data-name");d&&(o=function(){var e=t();return!isUndefined(e.params)&&isUndefined(e.params.name)&&(e.params.name=d),e})}}return originalComponentInit(e,o,n,i,r)};var originalComponentRegisterFunc=fw.components.register,registerComponent=fw.components.register=function(e,t){var n=t.initialize||t.viewModel;if(!isString(e))throw"Components must be provided a componentName.";isFunction(n)&&!isViewModelCtor(n)&&(t.namespace=e,n=makeViewModel(t)),originalComponentRegisterFunc(e,{viewModel:n||fw.viewModel(),template:t.template})};fw.components.getNormalTagList=function(){return nonComponentTags.splice(0)},fw.components.getComponentNameForNode=function(e){var t=isString(e.tagName)&&e.tagName.toLowerCase();return fw.components.isRegistered(t)||tagIsComponent(t)?t:null};var makeComponent=fw.component=function(e){var t=e.viewModel;return isFunction(t)&&!isViewModelCtor(t)&&(e.viewModel=makeViewModel(omit(e,"template"))),e},componentTemplateOnlyRegister=[],registerComponentAsTemplateOnly=fw.components.isTemplateOnly=function(e,t){return t=isUndefined(t)?!0:t,isArray(e)&&each(e,function(e){registerComponentAsTemplateOnly(e,t)}),componentTemplateOnlyRegister[e]=t,isArray(e)?void 0:componentTemplateOnlyRegister[e]||"normal"},nonComponentTags=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","embed","fieldset","figcaption","figure","footer","form","frameset","g","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","mark","marquee","menu","menuitem","meta","meter","nav","nobr","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","polygon","path","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","xmp"],tagIsComponent=fw.components.tagIsComponent=function(e,t){return isUndefined(t)?-1===indexOf(nonComponentTags,e):(isArray(e)&&each(e,function(e){tagIsComponent(e,t)}),t!==!0?contains(nonComponentTags,e)===!1&&nonComponentTags.push(e):nonComponentTags=filter(nonComponentTags,function(t){return t!==e}),void 0)},nativeComponents=["outlet"];fw.virtualElements.allowedBindings.$life=!0,fw.bindingHandlers.$life={init:function(e,t,n,i){fw.utils.domNodeDisposal.addDisposeCallback(e,function(){isViewModel(i)&&i.__shutdown()})},update:function(e,t,n,i,r){var o=r.$parent;isObject(o)&&o.__isOutlet?o.$route().__getOnCompleteCallback()(e.parentElement):componentTriggerAfterBinding(e.parentElement,r.$data)}};var componentWrapperTemplate="<!-- ko $life -->COMPONENT_MARKUP<!-- /ko -->";fw.components.loaders.unshift(fw.components.componentWrapper={loadTemplate:function(e,t,n){if(isNativeComponent(e))n(null);else{if(!isString(t))throw"Unhandled config type "+typeof t+".";t=componentWrapperTemplate.replace(/COMPONENT_MARKUP/,t),fw.components.defaultLoader.loadTemplate(e,t,n)}},loadViewModel:function(e,t,n){var i=t.viewModel||t;isNativeComponent(e)?n(null):n(function(e,t){var n=fw.contextFor(t.element),r=i;return isFunction(i)?(isViewModelCtor(i)||(i=makeViewModel({initialize:i})),r=i.compose({_preInit:function(){this.$context=n}}),new r(e)):r})}}),fw.components.loaders.push(fw.components.requireLoader={getConfig:function(e,t){var n,i,r,o=getComponentFileName(e,"combined"),s=getComponentFileName(e,"viewModel"),a=getComponentFileName(e,"template"),u=getComponentResourceLocation(e),c=null;if(isFunction(require))if(require.defined(e))c={require:e};else if(isString(u.combined))r=u.combined,isPath(r)&&(r+=o),c={require:r};else{n=u.viewModels,i="text!"+u.templates,isPath(n)&&(n+=s),isPath(i)&&(i+=a);var l={require:n};componentTemplateOnlyRegister[e]&&(l={instance:{}}),c={viewModel:l,template:{require:i}}}t(c)}});var noParentViewModelError={getNamespaceName:function(){return"NO-VIEWMODEL-IN-CONTEXT"}};fw.virtualElements.allowedBindings.$bind=!0,fw.bindingHandlers.$bind={init:function(e,t,n,i,r){var o=isObject(r)?r.$parent||noParentViewModelError:noParentViewModelError,s=nearestParentRouter(r),a=i.outletName;if(!isRouter(s))throw"Outlet ["+a+"] defined inside of viewModel ["+o.getNamespaceName()+"] but no router was defined.";i.$route=s.$outlet(a)}},fw.components.register("outlet",{autoIncrement:!0,viewModel:function(e){this.outletName=fw.unwrap(e.name),this.__isOutlet=!0},template:"<!-- ko $bind, component: $route --><!-- /ko -->"}),fw.components.register("_noComponentSelected",{viewModel:function(){this.__assertPresence=!1},template:'<div class="no-component-selected"></div>'}),fw.components.register("error",{viewModel:function(e){this.message=fw.observable(e.message),this.errors=e.errors,this.__assertPresence=!1},template:'    <div class="component error" data-bind="foreach: errors">      <div class="error">        <span class="number" data-bind="text: $index() + 1"></span>        <span class="message" data-bind="text: $data"></span>      </div>    </div>'});var defaultComponentFileExtensions={combined:".js",viewModel:".js",template:".html"},componentFileExtensions=fw.components.fileExtensions=fw.observable(clone(defaultComponentFileExtensions)),getComponentFileName=fw.components.getFileName=function(e,t){var n=componentFileExtensions(),i=e;return isFunction(n)?i+=n(e)[t]:isObject(n)&&(i+=isFunction(n[t])?n[t](e):n[t]||""),i},defaultComponentLocation={combined:null,viewModels:"/viewModel/",templates:"/component/"},componentResourceLocations=fw.components.resourceLocations={},componentDefaultLocation=fw.components.defaultLocation=function(e,t){var n=isUndefined(t)||t===!0?defaultComponentLocation:clone(defaultComponentLocation);return isObject(e)?extend(n,reduce(e,function(e,t,n){return"viewModel"===n?(e.viewModels=t,delete e.viewModel):"template"===n?(e.templates=t,delete e.template):e[n]=t,e},{})):isString(e)&&(n={combined:rootURL,viewModels:null,templates:null}),n},registerLocationOfComponent=fw.components.registerLocation=function(e,t){isArray(e)&&each(e,function(e){registerLocationOfComponent(e,t)}),componentResourceLocations[e]=componentDefaultLocation(t,!1)},getComponentResourceLocation=fw.components.getResourceLocation=function(e){return isUndefined(e)?componentResourceLocations:componentResourceLocations[e]||defaultComponentLocation},defaultViewModelFileExtensions=".js",viewModelFileExtensions=fw.viewModels.fileExtensions=fw.observable(defaultViewModelFileExtensions),getViewModelFileName=fw.viewModels.getFileName=function(e){var t=viewModelFileExtensions(),n=e;return isFunction(t)?n+=t(e):isString(t)&&(n+=t),n},defaultViewModelLocation="/viewModel/",viewModelResourceLocations=fw.viewModels.resourceLocations={},viewModelDefaultLocation=fw.viewModels.defaultLocation=function(e,t){var n=defaultViewModelLocation;return isString(e)&&(n=e),t&&(defaultViewModelLocation=n),n},registeredViewModels={},registerViewModel=fw.viewModels.register=function(e,t){registeredViewModels[e]=t},isRegisteredViewModel=fw.viewModels.isRegistered=function(e){return!isUndefined(registeredViewModels[e])},getRegisteredViewModel=fw.viewModels.getRegistered=function(e){return registeredViewModels[e]},registerLocationOfViewModel=fw.viewModels.registerLocation=function(e,t){isArray(e)&&each(e,function(e){registerLocationOfViewModel(e,t)}),viewModelResourceLocations[e]=viewModelDefaultLocation(t,!1)},getViewModelResourceLocation=fw.viewModels.getResourceLocation=function(e){return isUndefined(e)?viewModelResourceLocations:viewModelResourceLocations[e]||getComponentResourceLocation(e).viewModels||defaultViewModelLocation};fw.extenders.throttled=function(e,t){isNumber(t)&&(t={timeout:t,when:function(){return!0}}),e.throttleEvaluation=t.timeout;var n=null,i=fw.dependentObservable({read:e,write:function(i){t.when(i)?(clearTimeout(n),n=setTimeout(function(){e(i)},t.timeout)):(clearTimeout(n),e(i))}});return i.force=function(t){clearTimeout(n),e(t)},i},fw.extenders.autoDisable=function(e,t){return e.extend({delayTrigger:{delay:t||0,trigger:function(e){e(!1)}}})},fw.extenders.autoEnable=function(e,t){return e.extend({delayTrigger:{delay:t||0,trigger:function(e){e(!0)}}})},fw.extenders.delayTrigger=function(e,t){var n,i=300,r=noop;isObject(t)?(i=!isNaN(t.delay)&&parseInt(t.delay,10)||i,r=t.trigger||r):i=!isNaN(t)&&parseInt(t,10)||i;var o=function(){clearTimeout(n),n=void 0},s=fw.computed({read:e,write:function(i){e(i),isUndefined(n)||o(),n=setTimeout(function(){r(e,t)}.bind(e),s.triggerDelay)}});return s.clearTrigger=o,s.triggerDelay=i,s},fw.extenders.delayWrite=function(e,t){var n,i=300;return isObject(t)?(i=!isNaN(t.delay)&&parseInt(t.delay,10)||i,n=t.filter||function(){return!0}):i=!isNaN(t)&&parseInt(t,10)||i,fw.computed({read:e,write:function(t){n(t)?(e._delayWriteTimer&&clearTimeout(this._delayWriteTimer),e._delayWriteTimer=setTimeout(function(){e(t)},i)):e(t)}})};