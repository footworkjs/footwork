/**
 * footwork.js - A solid base for structured knockout applications.
 * Author: Jonathan Newman (http://staticty.pe)
 * Version: v0.1.1
 * Url: http://footworkjs.com
 * License(s): MIT
 */
(function(t,n){"function"==typeof define&&define.amd?define(["underscore","knockout"],n):"object"==typeof exports?module.exports=n(require("underscore"),require("knockout")):t.ko=n(_,ko)})(this,function(t,n){function e(){var e=void 0,r=void 0,o={_:t,ko:n,Apollo:i};return function(){(function(t,n){"object"==typeof e&&e.exports?e.exports=n(require("underscore")):"function"==typeof r&&r.amd?r(["underscore"],function(e){return n(e,t)}):t.riveter=n(t._,t)})(this,function(t){var n=Array.prototype.slice,e=function(){for(var t=n.call(arguments,0);t.length;)e.rivet(t.shift())};return e.rivet=function(t){t.hasOwnProperty("extend")||(t.extend=function(n,i){return e.extend(t,n,i)}),t.hasOwnProperty("compose")||(t.compose=function(){return e.compose.apply(this,[t].concat(n.call(arguments,0)))}),t.hasOwnProperty("inherits")||(t.inherits=function(n,i){e.inherits(t,n,i)}),t.hasOwnProperty("mixin")||(t.mixin=function(){e.mixin.apply(this,[t].concat(n.call(arguments,0)))})},e.inherits=function(n,i,r){var o,c=function(){},s=function(){i.apply(this,arguments)};return"object"==typeof n?(n.hasOwnProperty("constructor")&&(s=n.constructor),o=n):(s=n,o=n.prototype),e.rivet(s),t.defaults(s,i,r),c.prototype=i.prototype,s.prototype=new c,t.extend(s.prototype,o,{constructor:s}),s.__super=i,s.__super__=i.prototype,s},e.extend=function(t,n,i){return e.inherits(n,t,i)},e.compose=function(){var i=n.call(arguments,0),r=i.shift();e.rivet(r);var o=t.reduce(i,function(t,n){return n.hasOwnProperty("_preInit")&&t.preInit.push(n._preInit),n.hasOwnProperty("_postInit")&&t.postInit.push(n._postInit),n=n.mixin||n,t.items.push(n),t},{items:[],preInit:[],postInit:[]}),c=r.extend({constructor:function(){var e=n.call(arguments,0);t.each(o.preInit,function(t){t.apply(this,e)},this),r.prototype.constructor.apply(this,e),t.each(o.postInit,function(t){t.apply(this,e)},this)}});return e.rivet(c),t.defaults(c.prototype,t.extend.apply(null,[{}].concat(o.items))),c},e.mixin=function(){var i=n.call(arguments,0),r=i.shift();e.rivet(r),t.defaults(r.prototype,t.extend.apply(null,[{}].concat(i)))},e})}.call(o),function(){(function(t,n){"object"==typeof e&&e.exports?e.exports=n():"function"==typeof r&&r.amd?r(n(t)):t.Conduit=n(t)})(this,function(){function t(t){if("function"!=typeof t.target)throw new Error("You can only make functions into Conduits.");var n={pre:t.pre||[],post:t.post||[],all:[]},e=t.context,i=t.target,r={isTarget:!0,fn:t.sync?function(){var t=Array.prototype.slice.call(arguments,0),n=i.apply(e,t);return n}:function(t){var n=Array.prototype.slice.call(arguments,1);n.splice(1,1,i.apply(e,n)),t.apply(this,n)}},o=function(){n.all=n.pre.concat([r].concat(n.post))};o();var c=function(){var i,r,o=0,c=function s(){var c,a,u=Array.prototype.slice.call(arguments,0),l=o;o+=1,l<n.all.length&&(c=n.all[l],r="target"===r?"after":c.isTarget?"target":"before",t.sync?"before"===r?(a=c.fn.apply(c.context||e,u),s.apply(this,a||u)):(i=c.fn.apply(c.context||e,u)||i,s.apply(this,[i].concat(u))):c.fn.apply(c.context||e,[s].concat(u)))};return c.apply(this,arguments),i};return c.steps=function(){return n.all},c.context=function(t){return 0===arguments.length?e:void(e=t)},c.before=function(t,e){t="function"==typeof t?{fn:t}:t,e=e||{},e.prepend?n.pre.unshift(t):n.pre.push(t),o()},c.after=function(t,e){t="function"==typeof t?{fn:t}:t,e=e||{},e.prepend?n.post.unshift(t):n.post.push(t),o()},c.clear=function(){n={pre:[],post:[],all:[]},o()},c.target=function(t){return t&&(i=t),i},c}return{Sync:function(n){return n.sync=!0,t.call(this,n)},Async:function(n){return t.call(this,n)}}})}.call(o),function(){(function(t,n){"object"==typeof e&&e.exports?e.exports=n(require("lodash"),require("conduitjs"),this):"function"==typeof r&&r.amd?r(["lodash","conduitjs"],function(e,i){return n(e,i,t)}):t.postal=n(t._,t.Conduit,t)})(this,function(t,n,e){function i(){for(;_.length;)l.unsubscribe(_.shift())}function o(t,n){return{channel:l.configuration.SYSTEM_CHANNEL,topic:"subscription."+t,data:{event:"subscription."+t,channel:n.channel,topic:n.topic}}}function c(n){return"function"==typeof n?n:n?function(e){var i=0,r=0;return t.each(n,function(t,o){i+=1,("topic"===o&&l.configuration.resolver.compare(e.topic,n.topic)||"context"===o&&n.context===(e.callback.context&&e.callback.context()||e.context)||e[o]===n[o])&&(r+=1)}),i===r}:function(){return!0}}function s(t){var n,e=new h(t.channel||this.configuration.DEFAULT_CHANNEL,t.topic,t.callback),i=this.subscriptions[e.channel];return i||(i=this.subscriptions[e.channel]={}),n=this.subscriptions[e.channel][e.topic],n||(n=this.subscriptions[e.channel][e.topic]=[]),n.push(e),e}function a(n){++v,n.channel=n.channel||this.configuration.DEFAULT_CHANNEL,n.timeStamp=new Date,t.each(this.wireTaps,function(t){t(n.data,n)}),this.subscriptions[n.channel]&&t.each(this.subscriptions[n.channel],function(t){for(var e,i=0,r=t.length;r>i;)(e=t[i++])&&y(e,n)}),0===--v&&i()}function u(){for(var t,n=0,e=Array.prototype.slice.call(arguments,0);t=e.shift();){if(v)return void _.push(t);if(this.subscriptions[t.channel]&&this.subscriptions[t.channel][t.topic]){var i=this.subscriptions[t.channel][t.topic].length;for(n=0;i>n;){if(this.subscriptions[t.channel][t.topic][n]===t){this.subscriptions[t.channel][t.topic].splice(n,1);break}n+=1}}l.publish(o("removed",t))}}var l,f=e.postal,p=function(t){this.channel=t||l.configuration.DEFAULT_CHANNEL,this.initialize()};p.prototype.initialize=function(){var t=this.publish;this.publish=new n.Async({target:t,context:this})},p.prototype.subscribe=function(){return l.subscribe({channel:this.channel,topic:1===arguments.length?arguments[0].topic:arguments[0],callback:1===arguments.length?arguments[0].callback:arguments[1]})},p.prototype.publish=function(){var t=1===arguments.length?"[object String]"===Object.prototype.toString.call(arguments[0])?{topic:arguments[0]}:arguments[0]:{topic:arguments[0],data:arguments[1]};t.channel=this.channel,l.publish(t)};var h=function(t,n,e){if(3!==arguments.length)throw new Error("You must provide a channel, topic and callback when creating a SubscriptionDefinition instance.");if(0===n.length)throw new Error("Topics cannot be empty");this.channel=t,this.topic=n,this.subscribe(e)},d=function(){var n;return function(e){var i=!1;return t.isString(e)?(i=e===n,n=e):(i=t.isEqual(e,n),n=t.clone(e)),!i}},b=function(){var n=[];return function(e){var i=!t.any(n,function(n){return t.isObject(e)||t.isArray(e)?t.isEqual(e,n):e===n});return i&&n.push(e),i}},m={withDelay:function(n){if(t.isNaN(n))throw"Milliseconds must be a number";return{name:"withDelay",fn:function(t,e,i){setTimeout(function(){t(e,i)},n)}}},defer:function(){return this.withDelay(0)},stopAfter:function(n,e){if(t.isNaN(n)||0>=n)throw"The value provided to disposeAfter (maxCalls) must be a number greater than zero.";var i=t.after(n,e);return{name:"stopAfter",fn:function(t,n,e){i(),t(n,e)}}},withThrottle:function(n){if(t.isNaN(n))throw"Milliseconds must be a number";return{name:"withThrottle",fn:t.throttle(function(t,n,e){t(n,e)},n)}},withDebounce:function(n,e){if(t.isNaN(n))throw"Milliseconds must be a number";return{name:"debounce",fn:t.debounce(function(t,n,e){t(n,e)},n,!!e)}},withConstraint:function(n){if(!t.isFunction(n))throw"Predicate constraint must be a function";return{name:"withConstraint",fn:function(t,e,i){n.call(this,e,i)&&t.call(this,e,i)}}},distinct:function(t){t=t||{};var n=function(t){return t[0]},e=t.all?new b(n):new d(n);return{name:"distinct",fn:function(t,n,i){e(n)&&t(n,i)}}}};h.prototype={after:function(){return this.callback.after.apply(this,arguments),this},before:function(){return this.callback.before.apply(this,arguments),this},"catch":function(t){var n=this.callback.target(),e=function(){try{n.apply(this,arguments)}catch(e){t(e,arguments[0])}};return this.callback.target(e),this},defer:function(){return this.callback.before(m.defer()),this},disposeAfter:function(t){var n=this;return n.callback.before(m.stopAfter(t,function(){n.unsubscribe.call(n)})),n},distinctUntilChanged:function(){return this.callback.before(m.distinct()),this},distinct:function(){return this.callback.before(m.distinct({all:!0})),this},logError:function(){if(console){var t;t=console.warn?console.warn:console.log,this.catch(t)}return this},once:function(){return this.disposeAfter(1),this},subscribe:function(t){return this.callback=new n.Async({target:t,context:this}),this},unsubscribe:function(){this.inactive||(this.inactive=!0,l.unsubscribe(this))},withConstraint:function(t){return this.callback.before(m.withConstraint(t)),this},withConstraints:function(t){for(;t.length;)this.callback.before(m.withConstraint(t.shift()));return this},withDebounce:function(t,n){return this.callback.before(m.withDebounce(t,n)),this},withDelay:function(t){return this.callback.before(m.withDelay(t)),this},withThrottle:function(t){return this.callback.before(m.withThrottle(t)),this},withContext:function(t){return this.callback.context(t),this}};var g={cache:{},regex:{},compare:function(n,e){var i,r,o,c=this.cache[e]&&this.cache[e][n];return"undefined"!=typeof c?c:((r=this.regex[n])||(i="^"+t.map(n.split("."),function(t){var n="";return o&&(n="#"!==o?"\\.\\b":"\\b"),n+="#"===t?"[\\s\\S]*":"*"===t?"[^.]+":t,o=t,n}).join("")+"$",r=this.regex[n]=new RegExp(i)),this.cache[e]=this.cache[e]||{},this.cache[e][n]=c=r.test(e),c)},reset:function(){this.cache={},this.regex={}}},y=function(t,n){!t.inactive&&l.configuration.resolver.compare(t.topic,n.topic)&&t.callback(n.data,n)},v=0,_=[];if(l={configuration:{resolver:g,DEFAULT_CHANNEL:"/",SYSTEM_CHANNEL:"postal"},subscriptions:{},wireTaps:[],ChannelDefinition:p,SubscriptionDefinition:h,channel:function(t){return new p(t)},addWireTap:function(t){var n=this;return n.wireTaps.push(t),function(){var e=n.wireTaps.indexOf(t);-1!==e&&n.wireTaps.splice(e,1)}},noConflict:function(){if("undefined"==typeof window||"undefined"!=typeof window&&"function"==typeof r&&r.amd)throw new Error("noConflict can only be used in browser clients which aren't using AMD modules");return e.postal=f,this},getSubscribersFor:function(n){var e=[];return t.each(this.subscriptions,function(i){t.each(i,function(i){e=e.concat(t.filter(i,c(n)))})}),e},reset:function(){this.unsubscribeFor(),this.configuration.resolver.reset(),this.subscriptions={}},unsubscribeFor:function(t){var n=[];this.subscriptions&&(n=this.getSubscribersFor(t),this.unsubscribe.apply(this,n))}},l.subscribe=new n.Sync({target:s,context:l}),l.publish=n.Async({target:a,context:l}),l.unsubscribe=new n.Sync({target:u,context:l}),l.subscribe.after(function(t){l.publish(o("created",t))}),l.subscriptions[l.configuration.SYSTEM_CHANNEL]={},l.linkChannels=function(n,e){var i=[],r=this;return n=t.isArray(n)?n:[n],e=t.isArray(e)?e:[e],t.each(n,function(n){var o=n.topic||"#";t.each(e,function(e){var c=e.channel||r.configuration.DEFAULT_CHANNEL;i.push(r.subscribe({channel:n.channel||r.configuration.DEFAULT_CHANNEL,topic:o,callback:function(n,i){var o=t.clone(i);o.topic=t.isFunction(e.topic)?e.topic(i.topic):e.topic||i.topic,o.channel=c,o.data=n,r.publish(o)}}))})}),i},e&&Object.prototype.hasOwnProperty.call(e,"__postalReady__")&&t.isArray(e.__postalReady__))for(;e.__postalReady__.length;)e.__postalReady__.shift().onReady(l);return l})}.call(o),o}var i=function(){"use strict";var t,n,e,i,r={},o=function(t,n){"[object Array]"!==Object.prototype.toString.call(t)&&(t=t.split(" "));for(var e=0;e<t.length;e++)n(t[e],e)};return document.documentElement.classList?(t=function(t,n){return t.classList.contains(n)},n=function(t,n){t.classList.add(n)},e=function(t,n){t.classList.remove(n)},i=function(t,n){t.classList.toggle(n)}):(t=function(t,n){return new RegExp("(^|\\s)"+n+"(\\s|$)").test(t.className)},n=function(t,n){r.hasClass(t,n)||(t.className+=(t.className?" ":"")+n)},e=function(t,n){r.hasClass(t,n)&&(t.className=t.className.replace(new RegExp("(^|\\s)*"+n+"(\\s|$)*","g"),""))},i=function(t,n){var e=r.hasClass(t,n)?r.removeClass:r.addClass;e(t,n)}),r.hasClass=function(n,e){return t(n,e)},r.addClass=function(t,e){o(e,function(e){n(t,e)})},r.removeClass=function(t,n){o(n,function(n){e(t,n)})},r.toggleClass=function(t,n){o(n,function(n){i(t,n)})},r}(),r=e();return console.log("modules",e()),function(t,n,e,r){var o=n.applyBindings;n.applyBindings=function(t,n){o(t,n),"function"==typeof t.startup&&void 0!==t._options&&(t._options.startup!==!1&&t.startup(),"function"==typeof t._modelOptions.afterBinding&&t._modelOptions.afterBinding.call(t))},n.bindingHandlers.registerElement={preprocess:function(t){return"'"+t+"'"},init:function(e,i,r,o){var c=n.unwrap(i()),s={name:e.getAttribute("id")||e.getAttribute("name"),context:"relative"};"string"==typeof c?c=t.extend(s,{name:c}):"object"==typeof c&&(c=t.extend(s,c)),"object"!=typeof o.el&&(o.el={}),o.el[c.name]=e}},n.bindingHandlers["class"]={update:function(t,e){t.__ko__previousClassValue__&&i.removeClass(t,t.__ko__previousClassValue__);var r=n.utils.unwrapObservable(e());void 0!==r&&i.addClass(t,r),t.__ko__previousClassValue__=r}},n.bindingHandlers.stopBinding={init:function(){return{controlsDescendantBindings:!0}}},n.extenders.throttle=function(t,e){"number"==typeof e&&(e={timeout:e,when:function(){return!0}}),t.throttleEvaluation=e.timeout;var i=null,r=n.dependentObservable({read:t,write:function(n){e.when(n)?(clearTimeout(i),i=setTimeout(function(){t(n)},e.timeout)):(clearTimeout(i),t(n))}});return r.force=function(n){clearTimeout(i),t(n)},r},n.extenders.autoDisable=function(t,n){return t.extend({delayTrigger:{delay:n||0,trigger:function(t){t(!1)}}})},n.extenders.autoEnable=function(t,n){return t.extend({delayTrigger:{delay:n||0,trigger:function(t){t(!0)}}})},n.extenders.delayTrigger=function(t,e){var i,r=300,o=function(){};"object"==typeof e?(r=!isNaN(e.delay)&&parseInt(e.delay,10)||r,o=e.trigger||o):r=!isNaN(e)&&parseInt(e,10)||r;var c=function(){clearTimeout(i),i=void 0},s=n.computed({read:t,write:function(n){t(n),void 0!==i&&c(),i=setTimeout(function(){o(t,e)}.bind(t),s.triggerDelay)}});return s.clearTrigger=c,s.triggerDelay=r,s},n.extenders.delayWrite=function(t,e){var i,r=300;return"object"==typeof e?(r=!isNaN(e.delay)&&parseInt(e.delay,10)||r,i=e.filter||function(){return!0}):r=!isNaN(e)&&parseInt(e,10)||r,n.computed({read:t,write:function(n){i(n)?(t._delayWriteTimer&&clearTimeout(this._delayWriteTimer),t._delayWriteTimer=setTimeout(function(){t(n)},r)):t(n)}})},n.subscribable.fn.receiveFrom=function(e,i){var o,c=this,s=this;if(t.isObject(e)===!0&&void 0!==e.channel)o=e;else{if("string"!=typeof e)throw"Invalid namespace ["+typeof e+"]";o=r.channel(e)}return s=n.computed({read:c,write:function(t){o.publish("change."+i,t)}}),s.refresh=function(){o.publish("refresh."+i)},o.subscribe(i,function(t){c(t)}),s.__isReceived=!0,s},n.subscribable.fn.broadcastAs=function(e,i){var r,o=this;return i=t.isObject(e)===!0?e:"boolean"==typeof i?{name:e,writable:i}:t.isObject(i)===!0?t.extend({name:e},i):{name:e},r=i.namespace||n.currentNamespace(),i.writable&&r.subscribe("change."+i.name,function(t){o(t)}),r.subscribe("refresh."+i.name,function(){r.publish(i.name,o())}),o.subscribe(function(t){r.publish(i.name,t)}),o.__isBroadcast=!0,o},n.__nsStack=[],n.namespace=function(t){return r.channel(t)},n.currentNamespace=function(){return n.namespace(n.__nsStack[0])},n.enterNamespace=function(t){n.__nsStack.unshift(t)},n.exitNamespace=function(){n.__nsStack.shift()},n.modelCount=function(){var n=t.reduce(u,function(t,n,e){return t[e]=n+1,t},{});return n.__total=t.reduce(t.values(n),function(t,n){return t+n},0),n},n.getModels=function(){return c},n.debugModels=function(t){a=t},n.refreshModels=function(){t.invoke(n.getModels(),"refreshReceived")};var c={},s=0,a=!1,u={},l=function(t,n){return void 0===u[t]?u[t]=0:u[t]++,t+(n===!0&&u[t]>0?u[t]:"")};return n.model=function(i){i=t.extend({namespace:void 0,autoIncrement:!1,mixins:void 0,params:void 0,afterBinding:function(){},factory:function(){}},i);var r={_preInit:function(e){i.namespace=l(i.namespace,i.autoIncrement),this._modelOptions=i,n.enterNamespace(i.namespace),this._options=t.extend({namespace:i.namespace||"namespace"+s},e),s++,this.namespace=n.namespace(this.namespace=this._options.namespace),"/"!==n.currentNamespace().channel&&(this.namespace=n.currentNamespace()),this._globalChannel=n.namespace()},mixin:{namespaceName:i.namespace,broadcastAll:function(){var n=this;return"object"==typeof this._broadcast&&t.each(this._broadcast,function(t,e){n.namespace.publish(e,t())}),t.each(this,function(e,i){t.isObject(e)===!0&&e.__isBroadcast===!0&&n.namespace.publish(i,e())}),this},refreshReceived:function(){return"object"==typeof this._receive&&void 0!==this._receive.refresh&&(t.invoke(this._receive,"refresh"),"object"==typeof this._receive.config&&t.invoke(this._receive.config,"refresh")),t.each(this,function(n){t.isObject(n)===!0&&n.__isReceived===!0&&n.refresh()}),t.isObject(this.config)===!0&&t.invoke(this.config,"refresh"),this},startup:function(){return this.refreshReceived().broadcastAll(),this}},_postInit:function(){a===!0&&(c[n.currentNamespace().channel]=this),n.exitNamespace(),this.startup(),"function"==typeof this._modelOptions.afterCreating&&this._modelOptions.afterCreating.call(this)}},o=[i.factory,r];return void 0!==i.mixins&&(o=o.concat(i.mixins)),e.compose.apply(void 0,o)},n}(r._,r.ko,r.riveter,r.postal)});