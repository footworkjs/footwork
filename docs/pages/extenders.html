
  
  <p>custom throttle() based on ko v3.0.0 throttle(), allows value to be force()â€™d to a value at any time</p>

  
    <div class='highlight'><pre>ko.extenders.throttle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(target, opt)</span> {</span>
  <span class="hljs-keyword">if</span>( <span class="hljs-keyword">typeof</span> opt === <span class="hljs-string">'number'</span> ) {
    opt = {
      timeout: opt,
      when: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; } <span class="hljs-comment">// default always throttle</span>
    };
  }

  target.throttleEvaluation = opt.timeout;

  <span class="hljs-keyword">var</span> writeTimeoutInstance = <span class="hljs-literal">null</span>,
      throttledTarget = ko.dependentObservable({
          <span class="hljs-string">'read'</span>: target,
          <span class="hljs-string">'write'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value)</span> {</span>
            <span class="hljs-keyword">if</span>( opt.when(value) ) {
              clearTimeout(writeTimeoutInstance);
              writeTimeoutInstance = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                target(value);
              }, opt.timeout);
            } <span class="hljs-keyword">else</span> {
              clearTimeout(writeTimeoutInstance);
              target(value);
            }
          }
      });

  throttledTarget.force = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( value )</span> {</span>
    clearTimeout(writeTimeoutInstance);
    target(value);
  };

  <span class="hljs-keyword">return</span> throttledTarget;
};

ko.extenders.autoDisable = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( target, delay )</span> {</span>
  <span class="hljs-keyword">return</span> target.extend({
    delayTrigger: {
      delay: delay || <span class="hljs-number">0</span>,
      trigger: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( target )</span> {</span> target( <span class="hljs-literal">false</span> ); }
    }
  });
};

ko.extenders.autoEnable = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( target, delay )</span> {</span>
  <span class="hljs-keyword">return</span> target.extend({
    delayTrigger: {
      delay: delay || <span class="hljs-number">0</span>,
      trigger: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( target )</span> {</span> target( <span class="hljs-literal">true</span> ); }
    }
  });
};

ko.extenders.delayTrigger = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( target, options )</span> {</span>
  <span class="hljs-keyword">var</span> delay = <span class="hljs-number">300</span>,
      triggerFunc = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>},
      trigger;

  <span class="hljs-keyword">if</span>( <span class="hljs-keyword">typeof</span> options === <span class="hljs-string">'object'</span> ) {
    delay = !<span class="hljs-built_in">isNaN</span>( options.delay ) &amp;&amp; <span class="hljs-built_in">parseInt</span>( options.delay, <span class="hljs-number">10</span> ) || delay;
    triggerFunc = options.trigger || triggerFunc;
  } <span class="hljs-keyword">else</span> {
    delay = !<span class="hljs-built_in">isNaN</span>( options ) &amp;&amp; <span class="hljs-built_in">parseInt</span>( options, <span class="hljs-number">10</span> ) || delay;
  }

  <span class="hljs-keyword">var</span> clearTrigger = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    clearTimeout( trigger );
    trigger = <span class="hljs-literal">undefined</span>;
  };

  <span class="hljs-keyword">var</span> delayedObservable = ko.computed({
    read: target,
    write: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( state )</span> {</span>
      target( state );

      <span class="hljs-keyword">if</span>( trigger !== <span class="hljs-literal">undefined</span> ) {
        clearTrigger();
      }

      trigger = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        triggerFunc( target, options );
      }.bind(target), delayedObservable.triggerDelay);
    }
  });
  delayedObservable.clearTrigger = clearTrigger;
  delayedObservable.triggerDelay = delay;

  <span class="hljs-keyword">return</span> delayedObservable;
};

ko.extenders.delayWrite = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( target, options )</span> {</span>
  <span class="hljs-keyword">var</span> filter, delay = <span class="hljs-number">300</span>;

  <span class="hljs-keyword">if</span>( <span class="hljs-keyword">typeof</span> options === <span class="hljs-string">'object'</span> ) {
    delay = !<span class="hljs-built_in">isNaN</span>( options.delay ) &amp;&amp; <span class="hljs-built_in">parseInt</span>( options.delay, <span class="hljs-number">10</span> ) || delay;
    filter = options.filter || <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; };
  } <span class="hljs-keyword">else</span> {
    delay = !<span class="hljs-built_in">isNaN</span>( options ) &amp;&amp; <span class="hljs-built_in">parseInt</span>( options, <span class="hljs-number">10</span> ) || delay;
  }

  <span class="hljs-keyword">return</span> ko.computed({
    read: target,
    write: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( writeValue )</span> {</span>
      <span class="hljs-keyword">if</span>( filter( writeValue ) ) {
        <span class="hljs-keyword">if</span>(target._delayWriteTimer) {
          clearTimeout( <span class="hljs-keyword">this</span>._delayWriteTimer );
        }
        target._delayWriteTimer = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          target( writeValue );
        }, delay);
      } <span class="hljs-keyword">else</span> {
        target( writeValue );
      }
    }
  });
};</pre></div>
  

