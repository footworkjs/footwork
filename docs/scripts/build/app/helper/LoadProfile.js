define(["lodash","jquery","knockout-footwork"],function(e,t,n){return function r(n){var i=[[[120,{point:25,duration:120}],[120,{point:35,duration:50}],[200,{point:55,duration:50}],[400,{point:80,duration:50}]],[[120,{point:25,duration:50}],[100,{point:35,duration:50}],[200,{point:65,duration:50}],[400,{point:80,duration:50}]],[[100,{point:30,duration:50}],[200,{point:35,duration:50}],[300,{point:50,duration:50}],[400,{point:80,duration:50}]]],r=this,s,o,u,a,f,l;n=e.extend({alwaysNewProfile:!0,adjustment:1,onStep:[],onStart:[],onEnd:[]},n);var c=function(e){var t=2;return e.slice(0,t)!=="on"&&(t=0),e=e.slice(t),"on"+e.charAt(0).toUpperCase()+e.slice(1)},h=function(t,r){e.each(n[c(t)],function(e){typeof e=="function"&&e(r)})},p=function(){var t;a===undefined&&(a=0);if(f===undefined||f[a]===undefined)f=o.shift(),a=0;if(f!==undefined){if(a<f.length){t=f[a];if(typeof t=="number")t={duration:t};else if(e.isObject(t)===!1)throw"Invalid step definition ["+typeof t+"], can only accept number or object";l=setTimeout(p,Math.floor(t.duration*n.adjustment)),h("step",t),a++}}else h("end")};this.bind=function(e,t){var r=c(e);return n[r]instanceof Array&&n[r].push(t),this},this.unbind=function(t,r){var i=c(t);return n[i]!==undefined&&(n[i]=e.reject(n[i],function(e){return e===r})),this};var d=function(){f=undefined,a=undefined,u=0};this.start=function(){return d(),n.alwaysNewProfile&&this.chooseProfile(),o=this.getProfile(),clearTimeout(l),h("start"),p(),this},this.end=function(){clearTimeout(l),h("end",!0)},this.getProfile=function(){return t.extend(!0,[],s)},(this.chooseProfile=function(){return s=i[Math.floor(Math.random()*i.length)],d(),this})()}});