define(["jquery","lodash","knockout-footwork","LoadState"],function(e,t,n,r){return n.model({namespace:"Navigation",factory:function(){this.viewPortLayoutMode=n.observable().receiveFrom("ViewPort","layoutMode"),this.configVisible=n.observable().receiveFrom("Configuration","visible"),this.headerMaxHeight=n.observable().receiveFrom("Configuration","headerMaxHeight"),this.paneCollapsed=n.observable().receiveFrom("Configuration","paneCollapsed"),this.transitionsEnabled=n.observable().receiveFrom("Configuration","transitionsEnabled"),this.defaultHeaderMaxHeight=n.observable().receiveFrom("Configuration","defaultHeaderMaxHeight"),this.configReflowing=n.observable().receiveFrom("Configuration","reflowing"),this.headerFixed=n.observable().receiveFrom("Header","fixed"),this.headerContentHeight=n.observable().receiveFrom("Header","contentHeight"),this.toggleButtonMinHeight=n.observable().receiveFrom("Header","sourceLinkVisibleMinHeight"),this.sourceLinkVisible=n.observable().receiveFrom("Header","sourceLinkVisible"),this.loadBarTopPos=n.observable(0).receiveFrom("Header","visibleHeight"),this.headerMoving=n.observable(!1).receiveFrom("Header","moving"),this.offsetMargin=n.observable().receiveFrom("Pane","columnWidth"),this.paneAnimate3d=n.observable().receiveFrom("Pane","animate3d"),this.paneMoving=n.observable().receiveFrom("Pane","moving"),this.overlapPane=n.observable().receiveFrom("Body","overlapPane"),this.pageLoading=n.observable().receiveFrom("Page","loading"),this.reflowing=n.observable(!1).broadcastAs("reflowing"),this.headerOpen=n.observable(!1),this.loader=new r({ignoreStatus:404}),this._globalChannel.subscribe("configReset",function(){this.headerOpen(!1)}).withContext(this);var t=n.namespace("Page");t.subscribe("loadingPage",function(e){this.loader.watch(e,this.viewPortLayoutMode()==="mobile"?400:300,function(){this._globalChannel.publish("refreshDocSize")}.bind(this)).fail(function(e){e.status===404&&this.loader.setState("ready")}.bind(this))}).withContext(this),this.toggleConfigView=function(){this.configVisible(!this.configVisible()),this.configVisible()&&this.paneCollapsed()&&this.paneCollapsed(!1)}.bind(this),this.toggleHeader=function(){(this.paneAnimate3d()===!0&&this.paneMoving()===!0||this.configReflowing()===!0||this.headerMoving()===!0)==0&&this.headerOpen(!this.headerOpen())}.bind(this),this.namespace.subscribe("toggleHeader",function(){this.toggleHeader()}.bind(this)),this.dropHidden=n.computed(function(){return this.overlapPane()&&this.paneCollapsed()===!1},this),this.headerDropVisible=n.computed(function(){return this.headerFixed()===!0&&this.reflowing()===!1||this.overlapPane()&&this.paneCollapsed()===!1?!1:this.sourceLinkVisible()===!1||this.headerOpen()},this),this.headerOpen.subscribe(function(t){var n=this.toggleButtonMinHeight(),r=this.transitionsEnabled()?1e3:0,i,s;this._headerAnimation&&(this._oldHeaderHeight=this.defaultHeaderMaxHeight(),this._headerAnimation.stop()),this.reflowing(!0),t?(this._oldHeaderHeight=this.headerMaxHeight(),i=this._oldHeaderHeight,s=n):(i=this.headerMaxHeight(),s=this._oldHeaderHeight),this._headerAnimation=e({height:i}).animate({height:s},{duration:r,specialEasing:{height:"easeOutElastic"},step:function(e){this.headerMaxHeight(e)}.bind(this),complete:function(){this.reflowing(!1)}.bind(this)})}.bind(this)),this.arrowIcon=n.computed(function(){return this.headerOpen()&&"icon-arrow-up"||"icon-arrow-down"},this),this.dropInfoText=n.computed(function(){return this.headerOpen()?'Click to <strong>collapse</strong> the header. <span class="shortcut">ctrl + x</span>':'Click to <strong>expand</strong> the header. <span class="shortcut">ctrl + x</span>'},this)}})});