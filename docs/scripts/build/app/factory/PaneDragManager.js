define(["jquery","lodash","knockout-footwork"],function(e,t,n){return n.model({namespace:"PaneDragManager",afterCreating:function(){var n=e(".mobile-only.gripper"),r=e("#collapse-button");window.IOS_VERSION===undefined||window.IOS_VERSION<7?(n.bind("touchy-drag",this.dragHandler),r.bind("touchy-drag",this.dragHandler).bind("touchy-longpress",function(){clearTimeout(clickTimeout)}),r.data("touchyLongpress").settings.msThresh=CLICK_TIMEOUT-20,n.data("touchyDrag").settings.msHoldThresh=DRAG_START_THRESHOLD):(n.bind("touchy-longpress",this.touchHandler),r.bind("touchy-longpress",this.touchHandler),t.each([n,r],function(e){e.data("touchyLongpress").settings.msThresh=0}))},factory:function(){var e=[],t={movePoint:{x:0}},r,i,s=80,o=250,u=200,a=-50,f=.1,l=0,c=1e3/60,h=170,p=70;this.paneMoving=n.observable().receiveFrom("Pane","movingTimer"),this.paneCollapsed=n.observable().receiveFrom("Pane","collapsed"),this.paneDragging=n.observable().receiveFrom("Pane","dragging"),this.paneDragOffset=n.observable(0).receiveFrom("Pane","dragOffset"),this.paneTransition=n.observable(undefined).receiveFrom("Pane","transition"),this.paneTrueLeftOffset=n.observable(0).receiveFrom("Pane","trueLeftOffset"),this.paneWidth=n.observable(0).receiveFrom("Pane","width"),this.closedOffset=n.observable().receiveFrom("ViewPort","closedOffset"),this.openOffset=n.observable().receiveFrom("ViewPort","openOffset"),this.touchHandler=function(e,t,n,r){this.paneCollapsed(!this.paneCollapsed())}.bind(this),this.dragHandler=function(n,u,l,d){if(this.paneMoving()===!0)return!1;var v=d.startPoint.x-d.movePoint.x,m=this.closedOffset(),g=this.openOffset(),y=!1,b=!0;this.paneCollapsed()===!1?(v=v<0?0:v,v=v<m?v:m):(v=v>0?0:v,v=v>g?v:g),u==="start"?(this.paneDragging(!0),e=[],l.attr("id")==="collapse-button"&&(r=setTimeout(function(){this.paneDragging(!1),this.paneCollapsed(!this.paneCollapsed())}.bind(this),h))):(r!==undefined&&(clearTimeout(r),r=undefined),i!==undefined&&(clearTimeout(i),i=undefined)),(u==="move"||u==="end")&&this.paneDragOffset(v);if(u==="start"||u==="move")d.timestamp=(new Date).getTime(),e.push(d),e.length>2&&(t=e[e.length-2]);else if(u==="end"){var w=this.paneCollapsed(),E=e[e.length-1],S=this.paneCollapsed(),x=this.paneCollapsed(),T=E.timestamp-e[e.length-2].timestamp,N=E.velocity;E.movePoint.x<t.movePoint.x?S=b:E.movePoint.x>t.movePoint.x&&(S=y);if(N>f){w=S;var C=w===b?m:g,k=Math.floor(Math.abs(T*C/(N*c)))+a;if(x===b&&S===b||x===y&&S===y)C=0;k=k>o?o:k,k=k<s?s:k,w===this.paneCollapsed()&&(k=k>p?p:k),this.paneTransition("transform "+k+"ms linear, left "+k+"ms linear"),this.paneDragOffset(C),i=setTimeout(function(){this.paneTransition("none"),this.paneCollapsed(w),this.paneDragging(!1),this.paneDragOffset(0)}.bind(this),k)}else x===b&&parseInt(this.paneTrueLeftOffset(),10)<parseInt(this.paneWidth(),10)/2?w=y:x===y&&parseInt(this.paneTrueLeftOffset(),10)>parseInt(this.paneWidth(),10)/2&&(w=b),this.paneDragging(!1),this.paneMoving(!0),this.paneCollapsed(w),this.paneDragOffset(0)}}.bind(this),this.paneMoving.subscribe(function(e){e===!0?this.paneTransition("transform "+u+"ms linear, left "+u+"ms linear"):this.paneTransition("none")},this)}})});