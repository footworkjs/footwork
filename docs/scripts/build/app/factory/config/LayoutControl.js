define(["knockout-footwork","lodash"],function(e,t){return e.model({namespace:"LayoutControl",factory:function(){return this.active={header:e.observable(),column:e.observable(),corner:e.observable()},this.config={defaultPaneMaxWidth:e.observable().receiveFrom("Configuration","defaultPaneMaxWidth"),transitionsEnabled:e.observable().receiveFrom("Configuration","transitionsEnabled"),headerMinHeight:e.observable().receiveFrom("Configuration","headerMinHeight"),headerMaxHeight:e.observable().receiveFrom("Configuration","headerMaxHeight"),paneMinWidth:e.observable().receiveFrom("Configuration","paneMinWidth"),paneMaxWidth:e.observable().receiveFrom("Configuration","paneMaxWidth"),headerLimitHeight:e.observable().receiveFrom("Configuration","headerLimitHeight"),heightMutable:e.observable().receiveFrom("Configuration","heightMutable"),reflowing:e.observable().receiveFrom("Configuration","reflowing")},this.visible=e.observable(!1).receiveFrom("Configuration","visible"),this.visibleHeaderHeight=e.observable(0).receiveFrom("Header","visibleHeight"),this.paneCollapsed=e.observable(0).receiveFrom("Pane","collapsed"),this.columnWidth=e.observable(0).receiveFrom("Pane","columnWidth"),this.paneMaxWidth=e.observable(0).receiveFrom("Pane","maxWidth"),this.scrollPosition=e.observable(!1).receiveFrom("ViewPort","scrollPosition"),this.viewPortHas3dTransforms=e.observable(!1).receiveFrom("ViewPort","has3dTransforms"),this.enabled=e.computed(function(){return this.active.header()||this.active.column()||this.active.corner()},this).broadcastAs("enabled"),this.currentControl=e.observable(!1).broadcastAs("currentControl"),this.headerMutable=this.config.heightMutable.broadcastAs("headerMutable"),this.containerTop=e.observable(),this.containerMarginLeft=e.observable(),this.columnMutable=e.computed(function(){return this.paneCollapsed()===!1&&this.visible()},this),this.cornerMutable=e.computed(function(){return this.headerMutable()&&this.columnMutable()},this),this.headerTopOffset=e.computed(function(){return this.config.headerMaxHeight()-this.scrollPosition()+"px"},this),this.headerTopPos=e.computed(function(){var e="0px";return this.viewPortHas3dTransforms()===!1&&(e=this.headerTopOffset()),e},this),this.headerTopTransform=e.computed(function(){var e="none";return this.viewPortHas3dTransforms()===!0&&(e="translateY("+this.headerTopOffset()+")"),e},this),this.columnLeftOffset=e.computed(function(){return parseInt(this.columnWidth(),10)-10+"px"},this),this.columnLeftPos=e.computed(function(){var e="0px";return this.viewPortHas3dTransforms()===!1&&(e=this.columnLeftOffset()),e},this),this.columnTransform=e.computed(function(){var e="none";return this.viewPortHas3dTransforms()===!0&&(e="translateX("+this.columnLeftOffset()+")"),e},this),this.cornerTopOffset=e.computed(function(){return this.config.headerMaxHeight()-this.scrollPosition()-5+"px"},this),this.cornerLeftOffset=e.computed(function(){return parseInt(this.columnWidth())-15+"px"},this),this.cornerTopPos=e.computed(function(){var e="0px";return this.viewPortHas3dTransforms()===!1&&(e=this.cornerTopOffset()),e},this),this.cornerLeftPos=e.computed(function(){var e="0px";return this.viewPortHas3dTransforms()===!1&&(e=this.cornerLeftOffset()),e},this),this.cornerTransform=e.computed(function(){var e="none";return this.viewPortHas3dTransforms()===!0&&(e="translate3d("+this.cornerLeftOffset()+","+this.cornerTopOffset()+",0px)"),e},this),this.mutate={column:function(e){var t=this.paneMaxWidth(),n=this.config.paneMinWidth();e.x+=this._mouseOffset&&this._mouseOffset.left||0,e.x>=t&&(e.x=this.config.defaultPaneMaxWidth()>t?this.config.defaultPaneMaxWidth():t),e.x<n&&(e.x=n),this.config.paneMaxWidth(e.x)}.bind(this),header:function(e){var t=this.config.headerMinHeight(),n=this.config.headerLimitHeight();e.y+=this._mouseOffset&&this._mouseOffset.top||0,e.y<t?e.y=t:e.y>n&&(e.y=n),this.config.headerMaxHeight(e.y)}.bind(this),corner:function(e){this.mutate.column(e),this.mutate.header(e)}.bind(this)},this.mutateControl=function(e){this.mutate[this.currentControl()]({x:e.pageX,y:e.pageY})}.bind(this),this.enable=function(e,n){if(this.config.reflowing()===!1){var r=n.target.getAttribute("data-control");this._mouseOffset={left:parseInt(this.columnWidth(),10)-n.pageX,top:this.config.headerMaxHeight()-n.pageY},t.each(this.active,function(e,t){t===r?e(!0):e(!1)}),this.currentControl(r),this._globalChannel.publish("enableControl",this.mutateControl)}}.bind(this),this.disable=function(){this._mouseOffset={left:0,top:0},t.each(this.active,function(e){e(!1)}),this.currentControl(!1),this._globalChannel.publish("disableControl",this.mutateControl)}.bind(this),this.namespace.subscribe("disableControl",function(){this.disable()}).withContext(this),this}})});