define(["knockout-footwork","lodash"],function(e,t){return e.model({namespace:"Body",afterBinding:function(){this.initialized(!0)},factory:function(){this.initialized=e.observable(!1),this.configVisible=e.observable().receiveFrom("Configuration","visible"),this.configReflowing=e.observable().receiveFrom("Configuration","reflowing"),this.paneAccentPadding=e.observable().receiveFrom("Configuration","paneAccentPadding"),this.paneMinWidth=e.observable().receiveFrom("Configuration","paneMinWidth"),this.transitionsEnabled=e.observable(!1).receiveFrom("ViewPort","transitionsEnabled"),this.viewPortLayoutMode=e.observable().receiveFrom("ViewPort","layoutMode"),this.viewPortIsTablet=e.observable().receiveFrom("ViewPort","isTablet"),this.viewPortSmall=e.observable().receiveFrom("ViewPort","isSmall"),this.viewPortDim=e.observable().receiveFrom("ViewPort","dimensions"),this.scrollPosition=e.observable().receiveFrom("ViewPort","scrollPosition"),this.maxScrollResetPosition=e.observable().receiveFrom("ViewPort","maxScrollResetPosition"),this.viewPortHas3dTransforms=e.observable(!0).receiveFrom("ViewPort","has3dTransforms"),this.mainContentTopOffset=e.observable(0).receiveFrom("Header","height"),this.visibleHeaderHeight=e.observable(0).receiveFrom("Header","visibleHeight"),this.headerHeight=e.observable(0).receiveFrom("Header","height"),this.headerReflowing=e.observable(!1).receiveFrom("Header","reflowing"),this.headerMoving=e.observable(!1).receiveFrom("Header","moving"),this.headerTopOffset=e.observable().receiveFrom("Header","topOffset"),this.headerClosed=e.observable().receiveFrom("Header","closed"),this.visibleFooterHeight=e.observable(0).receiveFrom("Footer","visibleHeight"),this.footerHeight=e.observable(0).receiveFrom("Footer","height"),this.transform=e.observable().receiveFrom("Pane","transform"),this.paneWidth=e.observable(0).receiveFrom("Pane","width"),this.narrowPane=e.observable(!0).receiveFrom("Pane","narrow"),this.paneCollapsed=e.observable(!1).receiveFrom("Pane","collapsed"),this.paneMoving=e.observable(!1).receiveFrom("Pane","moving"),this.paneAnimate3d=e.observable(!1).receiveFrom("Pane","animate3d"),this.paneDragging=e.observable(!1).receiveFrom("Pane","dragging"),this.paneDragOffset=e.observable(0).receiveFrom("Pane","dragOffset"),this.paneTransition=e.observable(undefined).receiveFrom("Pane","transition"),this.pageLoading=e.observable(!1).receiveFrom("Page","loading"),this.paneColumnWidth=e.observable().receiveFrom("Pane","columnWidth"),this.controlEnabled=e.observable(!1).receiveFrom("LayoutControl","enabled"),this.currentControl=e.observable().receiveFrom("LayoutControl","currentControl"),this.width=e.computed(function(){return typeof this.viewPortDim()=="object"?this.viewPortDim().width-this.paneWidth()+"px":"0px"},this).broadcastAs("width"),this.overlapPane=e.computed(function(){return this.viewPortSmall()||this.viewPortLayoutMode()==="mobile"},this).broadcastAs("overlapPane"),this.height=e.observable().broadcastAs("height",!0),this.bodyState=e.computed(function(){var e=this.currentControl();return this.viewPortLayoutMode()+(e?" "+e+"-control":"")},this),this.isSmallViewport=e.computed(function(){return parseInt(this.paneColumnWidth(),10)<parseInt(this.paneMinWidth(),10)},this),this.transitionsDisabled=e.computed(function(){return this.transitionsEnabled()===!1},this),this.layoutTransitionsDisabled=e.computed(function(){return this.transitionsDisabled()||this.controlEnabled()||this.configReflowing()},this),this.isMobile=e.computed(function(){return this.viewPortLayoutMode()==="mobile"},this),this.isTablet=e.computed(function(){return this.viewPortIsTablet()},this),this.mainContentOffset=e.computed(function(){return parseInt(this.paneWidth(),10)+"px"},this),this.calculatedOffset=e.computed(function(){var e=parseInt(this.paneWidth(),10);return this.paneCollapsed()===!0&&(e=parseInt(this.paneAccentPadding(),10)),this.paneDragging()===!0&&(e-=this.paneDragOffset()),e},this),this.leftOffset=e.computed(function(){return this.paneAnimate3d()===!1?this.calculatedOffset()+"px":"0px"},this),this.topOffset=e.computed(function(){return this.headerClosed()?"0px":parseInt(this.visibleHeaderHeight(),10)+"px"},this),this.transform=e.computed(function(){var e=0;return this.paneAnimate3d()===!0&&(e=this.calculatedOffset()),"translate3d("+e+"px,0px,0px)"},this),this.minHeight=e.computed(function(){var e=this.scrollPosition(),t=this.maxScrollResetPosition(),n=this.viewPortDim(),r;return parseInt(this.visibleHeaderHeight(),10)===parseInt(this.headerHeight(),10)&&parseInt(this.visibleFooterHeight(),10)===parseInt(this.footerHeight(),10)?"":(n&&(e>=t?r=n.height+t:r=n.height+e,r+="px"),r)},this),this.minHeight.extend({throttle:150}).subscribe(function(){this._globalChannel.publish("refreshDocSize")},this),this.uiState=e.computed(function(){return{initialized:this.initialized(),loading:this.pageLoading(),tablet:this.isTablet(),narrow:this.narrowPane(),verySmall:this.isSmallViewport(),collapsed:this.paneCollapsed(),paneMoving:this.paneMoving(),overlapPane:this.overlapPane(),headerMoving:this.headerMoving(),headerReflowing:this.headerReflowing(),transitionsDisabled:this.transitionsDisabled(),layoutTransitionsDisabled:this.layoutTransitionsDisabled()}},this),this.togglePaneCollapse=function(){this.paneCollapsed(!this.paneCollapsed())}.bind(this),this.namespace.subscribe("togglePane",this.togglePaneCollapse)}})});