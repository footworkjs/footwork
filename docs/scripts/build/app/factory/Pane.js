define(["knockout-footwork","lodash"],function(e,t){return e.model({namespace:"Pane",factory:function(){this.config={paneMaxWidth:e.observable().receiveFrom("Configuration","paneMaxWidth"),paneCollapsed:e.observable().receiveFrom("Configuration","paneCollapsed"),paneAccentPadding:e.observable().receiveFrom("Configuration","paneAccentPadding"),linksMinWidth:e.observable().receiveFrom("Configuration","linksMinWidth"),reflowing:e.observable().receiveFrom("Configuration","reflowing")},this.viewPortDim=e.observable().receiveFrom("ViewPort","dimensions"),this.viewPortLayoutMode=e.observable({}).receiveFrom("ViewPort","layoutMode"),this.viewPortSmall=e.observable().receiveFrom("ViewPort","isSmall"),this.logoWidth=e.observable(161).receiveFrom("ViewPort","logoWidth"),this.viewPortHas3dTransforms=e.observable(!0).receiveFrom("ViewPort","has3dTransforms"),this.headerVisibleHeight=e.observable().receiveFrom("Header","visibleHeight"),this.headerClosed=e.observable().receiveFrom("Header","closed"),this.headerTopOffset=e.observable().receiveFrom("Header","topOffset"),this.headerClosedTopOffset=e.observable().receiveFrom("Header","closedTopOffset"),this.overlapPane=e.observable().receiveFrom("Body","overlapPane"),this.movingTimer=e.observable(!1).extend({autoDisable:400}).broadcastAs("movingTimer",!0),this.maxWidth=e.computed(function(){var e=this.viewPortDim();return e!==undefined&&e.width!==undefined?Math.floor(e.width/2.66):0},this).broadcastAs("maxWidth"),this.columnWidth=e.computed(function(){var e=this.config.paneMaxWidth(),t=this.maxWidth();return this.viewPortLayoutMode()!=="desktop"&&this.viewPortLayoutMode()!=="tablet"||this.viewPortSmall()?t+"px":t?(t<=e&&this.config.reflowing()===!1?t:e)+"px":9e3},this).broadcastAs("columnWidth"),this.shouldBeCollapsed=e.computed(function(){return this.viewPortSmall()},this).broadcastAs("shouldBeCollapsed"),this.narrow=e.computed(function(){return this.viewPortLayoutMode()==="desktop"||this.viewPortLayoutMode()==="tablet"?parseInt(this.columnWidth(),10)-this.logoWidth()-this.config.paneAccentPadding()*2<=this.config.linksMinWidth():!0},this).broadcastAs("narrow"),this.collapsed=this.config.paneCollapsed.broadcastAs("collapsed",!0),this.dragging=e.observable(!1).broadcastAs("dragging",!0),this.dragOffset=e.observable(0).broadcastAs("dragOffset",!0),this.moving=e.computed(function(){return this.movingTimer()===!0&&this.transition()===undefined},this).broadcastAs("moving"),this.scrolling=e.observable(!1).extend({autoDisable:500}).broadcastAs("scrolling",!0),this.transition=e.observable(undefined).broadcastAs("transition",!0),this.width=e.computed(function(){return this.overlapPane()===!0?this.viewPortDim().width-this.config.paneAccentPadding()+"px":this.columnWidth()},this).broadcastAs("width"),this.contentMaxHeight=e.computed(function(){var e=this.viewPortDim(),t=parseInt(this.headerVisibleHeight(),10),n=50,r=n;this.headerClosed()===!1&&(r+=t);if(this.viewPortLayoutMode()==="mobile"||this.narrow()===!0)r+=30;return e!==undefined?e.height-r:0},this).broadcastAs("contentMaxHeight"),this.animate3d=e.computed(function(){return this.viewPortHas3dTransforms()===!0&&this.overlapPane()===!0},this).broadcastAs("animate3d"),this.viewPortLayoutMode.subscribe(function(e){e==="mobile"?this.movingTimer.triggerDelay=300:this.movingTimer.triggerDelay=500},this),this.collapsed.subscribe(function(){this.dragging()===!1&&this.movingTimer(!0)},this),this.topOffset=e.computed(function(){return this.animate3d()===!0?"0px":this.headerClosed()===!1?parseInt(this.headerVisibleHeight(),10)+parseInt(this.headerTopOffset(),10)+"px":"0px"},this),this.trueLeftOffset=e.computed(function(){var e=0;return this.collapsed()===!0&&(e=parseInt(this.width(),10)-parseInt(this.config.paneAccentPadding(),10)),this.dragging()===!0&&(e+=this.dragOffset()),e+"px"},this).broadcastAs("trueLeftOffset"),this.leftOffset=e.computed(function(){return this.animate3d()===!0?"0px":"-"+this.trueLeftOffset()},this),this.transform=e.computed(function(){var e,t;return this.animate3d()===!0?(t=parseInt(this.headerVisibleHeight(),10),e=parseInt(this.trueLeftOffset(),10),this.headerClosed()===!0&&(t=0),"translate3d(-"+e+"px,"+t+"px,0px)"):"none"},this).broadcastAs("transform"),this.leftTransform=e.computed(function(){return this.animate3d()===!0?"translate3d(-"+this.trueLeftOffset()+",0px,0px)":"none"},this)}})});