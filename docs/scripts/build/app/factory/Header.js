define(["knockout-footwork","lodash"],function(e,t){return e.model({namespace:"Header",factory:function(){var n=!0,r=!1,i=1,s=-1,o=0,u=160;this.config={headerMinHeight:e.observable().receiveFrom("Configuration","headerMinHeight"),headerMaxHeight:e.observable().receiveFrom("Configuration","headerMaxHeight"),headerBorderWidth:e.observable().receiveFrom("Configuration","headerBorderWidth"),headerContentMaxHeight:e.observable().receiveFrom("Configuration","headerContentMaxHeight"),autoHideHeader:e.observable().receiveFrom("Configuration","autoHideHeader"),defaultHeaderMaxHeight:e.observable().receiveFrom("Configuration","defaultHeaderMaxHeight")},this.viewPortScrollPosition=e.observable(0).receiveFrom("ViewPort","scrollPosition"),this.viewPortLayoutMode=e.observable().receiveFrom("ViewPort","layoutMode"),this.viewPortIsMobile=e.observable().receiveFrom("ViewPort","isMobile"),this.viewPortHas3dTransforms=e.observable(!0).receiveFrom("ViewPort","has3dTransforms"),this.columnWidth=e.observable(0).receiveFrom("Pane","columnWidth"),this.paneCollapsed=e.observable().receiveFrom("Pane","collapsed"),this.paneMoving=e.observable().receiveFrom("Pane","moving"),this.navReflowing=e.observable().receiveFrom("Navigation","reflowing"),this.overlapPane=e.observable().receiveFrom("Body","overlapPane"),this.closable=e.computed(function(){return this.viewPortIsMobile()===!0||this.config.autoHideHeader()===!0},this),this.animate3d=e.computed(function(){return this.viewPortHas3dTransforms()===!0&&this.overlapPane()===!0},this),this.height=e.computed(function(){return Math.floor(this.config.headerMaxHeight()+this.config.headerBorderWidth())+"px"},this).broadcastAs("height"),this.closed=e.observable(!1).broadcastAs("closed",!0),this.closedTransform=e.computed(function(){return this.animate3d()===!0?this.closable()&&this.closed()?"translate3d(0px,-"+this.visibleHeight()+",0px)":"translate3d(0px,0px,0px)":"none"},this).broadcastAs("closedTransform"),this.visibleHeight=e.computed(function(){var e=this.config.headerMinHeight(),t=this.config.headerMaxHeight(),n=t-this.viewPortScrollPosition();return n=n>=e?n:e,n=n<=t?n:t,Math.floor(n+this.config.headerBorderWidth())+"px"},this).broadcastAs("visibleHeight"),this.sourceLinkVisibleMinHeight=e.observable(155).broadcastAs("sourceLinkVisibleMinHeight"),this.closePoint=e.computed(function(){return parseInt(this.height(),10)},this).broadcastAs("closePoint");var a=e.observable(!1).extend({throttle:{timeout:300,when:function(e){return e===!1}}});this.contentHeight=e.computed(function(){var e=this.config.headerContentMaxHeight(),t=parseInt(this.visibleHeight(),10);return t=t>=e?e:t,t-this.config.headerBorderWidth()+"px"},this).broadcastAs("contentHeight"),this.minHeight=e.computed(function(){return this.config.headerMinHeight()+this.config.headerBorderWidth()},this).broadcastAs("minHeight"),this.outerHeight=e.computed(function(){return this.config.headerBorderWidth()+parseInt(this.height(),10)+"px"},this).broadcastAs("outerHeight"),this.fixed=e.computed(function(){return this.config.headerMaxHeight()-this.viewPortScrollPosition()<this.config.headerMinHeight()},this).broadcastAs("fixed"),this.sourceLinkVisible=e.computed(function(){return parseInt(this.visibleHeight(),10)>=this.sourceLinkVisibleMinHeight()},this).broadcastAs("sourceLinkVisible"),this.pastClosePoint=e.computed(function(){return this.viewPortScrollPosition()>this.closePoint()},this).broadcastAs("pastClosePoint"),this.moving=a.extend({autoDisable:300}).broadcastAs("moving"),this.topOffset=e.computed(function(){return this.animate3d()===!1&&this.closed()===!0?"-"+this.visibleHeight():"0px"},this).broadcastAs("topOffset"),this.closed.subscribe(function(){this.moving(!0)},this),this.viewPortScrollPosition.subscribe(function(e){if(this.viewPortIsMobile()===!0||this.overlapPane()&&this.paneCollapsed()===!1||this.paneMoving()===!0)return!1;var a,f,l,c=this.closed(),h={direction:o,position:e,delta:0};if(this.closable()){if(this.pastClosePoint()===!1)return this.closed(r),!1;f=this._lastVector||t.extend({},h),l=this._lastVectorFlip||t.extend({},h),a={position:e,direction:e-f.position>=0?i:s,delta:Math.abs(l.position-e)},f.direction!==a.direction&&(this._lastVectorFlip=a,a.delta=0),a.delta>=u&&(a.direction===s?c=r:a.direction===i&&(c=n)),this.closed(c),this._lastVector=a}},this),this.fixed.subscribe(function(e){e===!1&&a.force(!1)},this),this.borderWidth=e.computed(function(){return this.config.headerBorderWidth()+"px"},this),this.sourceLinkHidden=e.computed(function(){return parseInt(this.visibleHeight(),10)<=this.config.headerContentMaxHeight()},this),this.headerStateCheck=e.computed(function(){var e=this.viewPortLayoutMode();e!=="mobile"&&this.pastClosePoint()===!1&&this.paneMoving()===!1&&this.paneCollapsed()===!0?this.closed(!1):e==="mobile"&&this.closed(!0)},this)}})});